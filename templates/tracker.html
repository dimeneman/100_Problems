<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Codeforces Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .problem { margin: 8px 0; }
    .progress { width: 100%; background: #ddd; border-radius: 5px; margin-top: 20px; }
    .progress-bar { height: 25px; background: green; width: 0%; border-radius: 5px; text-align: center; color: white; }
  </style>
</head>
<body>
  <h2>ðŸš€ Codeforces Problem Tracker</h2>
  <button onclick="logout()">Logout</button>
  <div id="problems"></div>

  <div class="progress">
    <div id="progress-bar" class="progress-bar">0%</div>
  </div>

  <script>
    async function fetchData() {
      const res = await fetch("/data");
      const data = await res.json();

      const container = document.getElementById("problems");
      container.innerHTML = "";

      data.problems.forEach(p => {
        const div = document.createElement("div");
        div.className = "problem";
        div.innerHTML = `
          <input type="checkbox" ${p.completed ? "checked" : ""} onchange="updateProblem('${p.name}', this.checked)">
          <a href="${p.link}" target="_blank">${p.name} (${p.rating})</a>
        `;
        container.appendChild(div);
      });

      updateProgress(data.progress);
    }

    async function updateProblem(name, completed) {
      await fetch("/update", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, completed })
      });
      fetchData();
    }

    function updateProgress(percent) {
      const bar = document.getElementById("progress-bar");
      bar.style.width = percent + "%";
      bar.innerText = percent + "%";
    }

    async function logout() {
      // Clear session on backend if needed
      await fetch("/logout");
      window.location.href = "/login";
    }

    fetchData();
  </script>
</body>
</html>
